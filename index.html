<script>
async function calculateControlled() {
  showPasswordPrompt(async () => {
    const investment = parseFloat(c_investment.value);
    const profit = parseFloat(c_profit.value);
    const loss = parseFloat(c_loss.value);
    const leverage = parseFloat(c_leverage.value);
    const entry = parseFloat(c_entry.value);
    const direction = c_direction.value;

    if ([investment, profit, loss, leverage, entry].some(isNaN)) {
      c_result.textContent = "Fill all fields.";
      return;
    }

    try {
      const response = await fetch('https://jars-backend.onrender.com/calculate/controlled', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ investment, profit, loss, leverage, entry, direction })
      });

      const data = await response.json();
      if (data.error) {
        c_result.textContent = data.error;
      } else {
        c_result.textContent = `TP: $${data.tp} | SL: $${data.sl}`;
      }
    } catch (err) {
      c_result.textContent = 'Error connecting to backend.';
    }
  });
}
</script>

